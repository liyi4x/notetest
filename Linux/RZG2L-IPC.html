
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>RZG2L-IPC · Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Liyi">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="RZG2L-Camera.html" />
    
    
    <link rel="prev" href="RZG2L-GPT.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../ROS/">
            
                <a href="../ROS/">
            
                    
                    ROS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../ROS/ROS开发环境.html">
            
                <a href="../ROS/ROS开发环境.html">
            
                    
                    ROS开发环境
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../ROS/二进制包和源码包.html">
            
                <a href="../ROS/二进制包和源码包.html">
            
                    
                    二进制包和源码包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../ROS/ROS工作空间.html">
            
                <a href="../ROS/ROS工作空间.html">
            
                    
                    ROS工作空间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../ROS/packages.html">
            
                <a href="../ROS/packages.html">
            
                    
                    packages
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../ROS/package.xml.html">
            
                <a href="../ROS/package.xml.html">
            
                    
                    package.xml
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../ROS/CMakeLists.txt.html">
            
                <a href="../ROS/CMakeLists.txt.html">
            
                    
                    CMakeLists.txt
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../ROS/ROS通信架构.html">
            
                <a href="../ROS/ROS通信架构.html">
            
                    
                    ROS通信架构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" data-path="../ROS/Launch文件.html">
            
                <a href="../ROS/Launch文件.html">
            
                    
                    Launch文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" data-path="../ROS/Topic和msg.html">
            
                <a href="../ROS/Topic和msg.html">
            
                    
                    Topic和msg
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" data-path="../ROS/Service和srv.html">
            
                <a href="../ROS/Service和srv.html">
            
                    
                    Service和srv
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" data-path="../ROS/Action.html">
            
                <a href="../ROS/Action.html">
            
                    
                    Action
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.5" data-path="../ROS/Parameter-server.html">
            
                <a href="../ROS/Parameter-server.html">
            
                    
                    Parameter server
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../ROS/roscpp.html">
            
                <a href="../ROS/roscpp.html">
            
                    
                    roscpp
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../ROS/init以及NodeHandle.html">
            
                <a href="../ROS/init以及NodeHandle.html">
            
                    
                    init以及NodeHandle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" data-path="../ROS/topic-in-roscpp.html">
            
                <a href="../ROS/topic-in-roscpp.html">
            
                    
                    topic in roscpp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" data-path="../ROS/service-in-roscpp.html">
            
                <a href="../ROS/service-in-roscpp.html">
            
                    
                    service in roscpp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../ROS/param-in-roscpp.html">
            
                <a href="../ROS/param-in-roscpp.html">
            
                    
                    param in roscpp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.5" data-path="../ROS/命名空间.html">
            
                <a href="../ROS/命名空间.html">
            
                    
                    命名空间
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.6" data-path="../ROS/roscpp时钟.html">
            
                <a href="../ROS/roscpp时钟.html">
            
                    
                    roscpp时钟
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.7" data-path="../ROS/日志和异常.html">
            
                <a href="../ROS/日志和异常.html">
            
                    
                    日志和异常
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../ROS/rospy.html">
            
                <a href="../ROS/rospy.html">
            
                    
                    rospy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../ROS/TF-坐标转换.html">
            
                <a href="../ROS/TF-坐标转换.html">
            
                    
                    TF 坐标转换
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.8.1" data-path="../ROS/TF-in-roscpp.html">
            
                <a href="../ROS/TF-in-roscpp.html">
            
                    
                    TF in roscpp
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Linux.html">
            
                <a href="Linux.html">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="Linux.html">
            
                <a href="Linux.html">
            
                    
                    RZG2L-关于sci(f)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="RZG2L-GPT.html">
            
                <a href="RZG2L-GPT.html">
            
                    
                    RZG2L-GPT
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="RZG2L-IPC.html">
            
                <a href="RZG2L-IPC.html">
            
                    
                    RZG2L-IPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="RZG2L-Camera.html">
            
                <a href="RZG2L-Camera.html">
            
                    
                    RZG2L-Camera
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="Auth.html">
            
                <a href="Auth.html">
            
                    
                    Auth UID加密
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="Linux-device-model.html">
            
                <a href="Linux-device-model.html">
            
                    
                    Linux-device-model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="Linux-reset-framework.html">
            
                <a href="Linux-reset-framework.html">
            
                    
                    Linux-reset-framework
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >RZG2L-IPC</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="rzg2l-inter-processor-communication">RZG2L Inter-processor communication</h1>
<ul>
<li><a href="#1-&#x5F02;&#x6784;&#x591A;&#x6838;&#x901A;&#x4FE1;">1. &#x5F02;&#x6784;&#x591A;&#x6838;&#x901A;&#x4FE1;</a><ul>
<li><a href="#11-&#x6570;&#x636E;&#x4F20;&#x9012;">1.1. &#x6570;&#x636E;&#x4F20;&#x9012;</a></li>
<li><a href="#12-remoteproc">1.2. Remoteproc</a></li>
<li><a href="#13-rpmsg">1.3. RPMsg</a></li>
<li><a href="#14-openamp">1.4. OpenAMP</a><ul>
<li><a href="#141-openamp&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;">1.4.1. OpenAMP&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-rzg2l&#x65B9;&#x6848;&#x6574;&#x4F53;&#x67B6;&#x6784;">2. RZG2L&#x65B9;&#x6848;&#x6574;&#x4F53;&#x67B6;&#x6784;</a></li>
<li><a href="#3-a55&#x6838;">3. A55&#x6838;</a><ul>
<li><a href="#31-&#x521D;&#x59CB;&#x5316;">3.1. &#x521D;&#x59CB;&#x5316;</a></li>
<li><a href="#32-&#x521B;&#x5EFA;remoteproc">3.2. &#x521B;&#x5EFA;remoteproc</a><ul>
<li><a href="#321-&#x5BF9;remoteproc&#x521D;&#x59CB;&#x5316;">3.2.1. &#x5BF9;remoteproc&#x521D;&#x59CB;&#x5316;</a></li>
<li><a href="#322-&#x5904;&#x7406;&#x8D44;&#x6E90;&#x8868;">3.2.2. &#x5904;&#x7406;&#x8D44;&#x6E90;&#x8868;</a></li>
</ul>
</li>
<li><a href="#33-&#x521B;&#x5EFA;rpmsg-device">3.3. &#x521B;&#x5EFA;RPMsg device</a><ul>
<li><a href="#331-&#x521B;&#x5EFA;virtio&#x8BBE;&#x5907;">3.3.1. &#x521B;&#x5EFA;virtio&#x8BBE;&#x5907;</a></li>
<li><a href="#332-&#x5904;&#x7406;vr_info-shmio">3.3.2. &#x5904;&#x7406;<code>vr_info-&gt;shm.io</code></a></li>
<li><a href="#333-&#x521D;&#x59CB;&#x5316;rpmsg_vdev">3.3.3. &#x521D;&#x59CB;&#x5316;rpmsg_vdev</a></li>
</ul>
</li>
<li><a href="#34-app">3.4. app</a><ul>
<li><a href="#341-&#x6784;&#x9020;payload">3.4.1. &#x6784;&#x9020;payload</a></li>
<li><a href="#342-&#x521B;&#x5EFA;endpoint">3.4.2. &#x521B;&#x5EFA;endpoint</a></li>
<li><a href="#343-poll">3.4.3. poll</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-cm33&#x6838;">4. CM33&#x6838;</a><ul>
<li><a href="#41-&#x6784;&#x5EFA;&#x9879;&#x76EE;">4.1. &#x6784;&#x5EFA;&#x9879;&#x76EE;</a><ul>
<li><a href="#411-&#x9879;&#x76EE;&#x7ED3;&#x6784;">4.1.1. &#x9879;&#x76EE;&#x7ED3;&#x6784;</a></li>
<li><a href="#412-&#x914D;&#x7F6E;&#x529F;&#x80FD;">4.1.2. &#x914D;&#x7F6E;&#x529F;&#x80FD;</a></li>
</ul>
</li>
<li><a href="#42-&#x5173;&#x4E8E;scif">4.2. &#x5173;&#x4E8E;SCIF</a><ul>
<li><a href="#421-gpio">4.2.1. GPIO</a></li>
<li><a href="#422-scif">4.2.2. SCIF</a></li>
<li><a href="#423-&#x5173;&#x4E8E;printf">4.2.3. &#x5173;&#x4E8E;printf</a></li>
</ul>
</li>
<li><a href="#43-&#x5173;&#x4E8E;&#x94FE;&#x63A5;">4.3. &#x5173;&#x4E8E;&#x94FE;&#x63A5;</a><ul>
<li><a href="#&#x70E7;&#x5F55;">&#x70E7;&#x5F55;</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li>
</ul>
<h2 id="1-&#x5F02;&#x6784;&#x591A;&#x6838;&#x901A;&#x4FE1;">1. &#x5F02;&#x6784;&#x591A;&#x6838;&#x901A;&#x4FE1;</h2>
<p>&#x591A;&#x6838;CPU&#x8FD0;&#x884C;&#x6A21;&#x5F0F;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#xFF1A;</p>
<ul>
<li>&#x975E;&#x5BF9;&#x79F0;&#x591A;&#x5904;&#x7406;&#xFF08;Asymmetric multiprocessing&#xFF0C;AMP&#xFF09;&#x6BCF;&#x4E2A;CPU&#x5185;&#x6838;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6216;&#x540C;&#x4E00;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x72EC;&#x7ACB;&#x5B9E;&#x4F8B;&#xFF08;instantiation&#xFF09;</li>
<li>&#x5BF9;&#x79F0;&#x591A;&#x5904;&#x7406;&#xFF08;Symmetric multiprocessing&#xFF0C;SMP&#xFF09;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x4F8B;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x7BA1;&#x7406;&#x6240;&#x6709;CPU&#x5185;&#x6838;&#xFF0C;&#x4E14;&#x5E94;&#x7528;&#x5E76;&#x4E0D;&#x7ED1;&#x5B9A;&#x67D0;&#x4E00;&#x4E2A;&#x5185;&#x6838;</li>
<li>&#x6DF7;&#x5408;&#x591A;&#x5904;&#x7406;&#xFF08;Bound multiprocessing&#xFF0C;BMP&#xFF09;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x5B9E;&#x4F8B;&#x53EF;&#x4EE5;&#x540C;&#x65F6;&#x7BA1;&#x7406;&#x6240;&#x6709;CPU&#x5185;&#x6838;&#xFF0C;&#x4F46;&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x88AB;&#x9501;&#x5B9A;&#x4E8E;&#x67D0;&#x4E2A;&#x6307;&#x5B9A;&#x7684;&#x6838;&#x5FC3;</li>
</ul>
<p>RZG2L&#x6709;&#x4E24;&#x4E2A;Cortex-A55@1.2GHz&#xFF0C;&#x4E00;&#x4E2A;Cortex-M33@200MH&#xFF0C;&#x5206;&#x522B;&#x8FD0;&#x884C;Linux&#x548C;Freertos&#xFF0C;&#x662F;AMP&#x7CFB;&#x7EDF;</p>
<h3 id="11-&#x6570;&#x636E;&#x4F20;&#x9012;">1.1. &#x6570;&#x636E;&#x4F20;&#x9012;</h3>
<ul>
<li>&#x5212;&#x5206;&#x4E00;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x8FD9;&#x5757;&#x5185;&#x5B58;M33&#x6838;&#x548C;A55&#x6838;&#x90FD;&#x80FD;&#x591F;&#x8BBF;&#x95EE;&#xFF0C;&#x4F5C;&#x4E3A;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#xFF0C;&#x7528;&#x6765;&#x4F20;&#x8F93;&#x6570;&#x636E;</li>
<li>&#x4F7F;&#x7528;&#x4E2D;&#x65AD;&#x6765;&#x4FDD;&#x8BC1;&#x540C;&#x6B65;&#xFF0C;&#x901A;&#x77E5;&#x5BF9;&#x65B9;&#x5B58;&#x53D6;&#x6570;&#x636E;</li>
</ul>
<p><img src="imgs/amp-ipi.png" alt="amp-ipi.png"></p>
<p>&#x5185;&#x5B58;&#x7684;&#x7BA1;&#x7406;&#x7531;&#x4E3B;&#x6838;&#x8D1F;&#x8D23;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A;&#x901A;&#x4FE1;&#x65B9;&#x5411;&#x4E0A;&#x90FD;&#x6709;&#x4E24;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x5206;&#x522B;&#x662F;USED&#x548C;AVAIL&#xFF0C;&#x8FD9;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x53EF;&#x4EE5;&#x6309;&#x7167;RPMsg&#x4E2D;&#x6D88;&#x606F;&#x7684;&#x683C;&#x5F0F;&#x5206;&#x6210;&#x4E00;&#x5757;&#x4E00;&#x5757;&#x94FE;&#x63A5;&#x5F62;&#x6210;&#x4E00;&#x4E2A;&#x73AF;</p>
<p><img src="imgs/amp-shared-mem.png" alt="amp-shared-mem.png"></p>
<h3 id="12-remoteproc">1.2. Remoteproc</h3>
<p>Remoteproc&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x5BF9;&#x8FDC;&#x7A0B;&#x5904;&#x7406;&#x5668;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x8FDB;&#x884C;&#x7BA1;&#x7406;&#xFF0C;&#x5373;&#x542F;&#x52A8;&#x3001;&#x505C;&#x6B62;&#x8FDC;&#x7A0B;&#x5904;&#x7406;&#x5668;&#x3002;&#x4F8B;&#x5982;A55&#x6838;&#x5148;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Remoteproc&#x8FDC;&#x7A0B;&#x52A0;&#x8F7D;&#x56FA;&#x4EF6;&#x3001;&#x8FDC;&#x7A0B;&#x542F;&#x52A8;M33&#x6838;</p>
<h3 id="13-rpmsg">1.3. RPMsg</h3>
<p>RPMsg&#x662F;&#x5B9E;&#x73B0;&#x5BF9;&#x8FDC;&#x7A0B;&#x5904;&#x7406;&#x5668;&#x4FE1;&#x606F;&#x4F20;&#x9012;&#xFF0C;&#x57FA;&#x4E8E;VirtIO&#x7684;&#x6D88;&#x606F;&#x603B;&#x7EBF;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x5185;&#x6838;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E0E;&#x7CFB;&#x7EDF;&#x4E0A;&#x53EF;&#x7528;&#x7684;&#x8FDC;&#x7A0B;&#x5904;&#x7406;&#x5668;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x516C;&#x5F00;&#x9002;&#x5F53;&#x7684;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x63A5;&#x53E3;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x4F1A;&#x628A;&#x5BF9;&#x5916;&#x63A5;&#x53E3;&#x5C01;&#x88C5;&#x6210;TTY&#x8BBE;&#x5907;&#x3002;</p>
<h3 id="14-openamp">1.4. OpenAMP</h3>
<p>OpenAMP&#x5305;&#x542B;&#x4E24;&#x90E8;&#x5206;&#xFF0C;<code>libmetal</code>&#x548C;<code>open_amp</code></p>
<ul>
<li><code>libmetal</code></li>
<li><code>open_amp</code><ul>
<li><code>virtio</code><ul>
<li>&#x662F;network&#x548C;disk device&#x7684;&#x865A;&#x62DF;&#x5316;&#x6807;&#x51C6;&#xFF0C;&#x7528;&#x6765;&#x7BA1;&#x7406;&#x5171;&#x4EAB;&#x5185;&#x5B58;</li>
</ul>
</li>
<li><code>rpmsg</code></li>
<li><code>remoteproc</code></li>
</ul>
</li>
</ul>
<p>OpenAMP&#x662F;Mentor Graphics&#x4E0E;&#x8D5B;&#x7075;&#x601D;&#x516C;&#x53F8;&#x4E3A;&#x4E86;&#x4F7F;&#x5728;AMP&#x7CFB;&#x7EDF;&#x7684;&#x8BBE;&#x8BA1;&#x4E2D;&#x5F00;&#x53D1;&#x51FA;&#x7684;RTOS&#x548C;&#x88F8;&#x673A;&#x7A0B;&#x5E8F;&#x80FD;&#x591F;&#x4E0E;&#x5F00;&#x6E90;Linux&#x793E;&#x533A;&#x63D0;&#x4F9B;&#x7684;&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x4E92;&#x901A;&#x8BAF;&#xFF0C;&#x800C;&#x5171;&#x540C;&#x901A;&#x8FC7;&#x7684;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x5316;&#x7684;&#x5D4C;&#x5165;&#x5F0F;&#x591A;&#x6838;&#x6846;&#x67B6;&#x3002;&#x63D0;&#x4F9B;&#x8FDC;&#x7A0B;&#x5904;&#x7406;&#x5668;&#x751F;&#x547D;&#x5468;&#x671F;&#x7BA1;&#x7406;&#x3001;&#x975E;&#x5BF9;&#x79F0;&#x591A;&#x6838;&#x901A;&#x4FE1;&#x7B49;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x7ED9;RTOS&#x6216;&#x8005;&#x88F8;&#x673A;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x3002;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;Linux&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x4E2D;&#x3002;</p>
<p>OpenAMP&#x4F7F;&#x7528;libmetal&#x4F5C;&#x4E3A;&#x62BD;&#x8C61;&#x5C42;&#x6765;&#x8BBF;&#x95EE;&#x8BBE;&#x5907;&#x3001;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x3001;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x3002;</p>
<h4 id="141-openamp&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;">1.4.1. OpenAMP&#x7684;&#x5E94;&#x7528;&#x573A;&#x666F;</h4>
<h5 id="1411-rpmsg-implementation-in-kernel-space">1.4.1.1. RPMsg Implementation in Kernel Space</h5>
<p>Linux kernel space provides RPMsg and Remoteproc, but the RPU application requires Linux to load it in order to talk to the RPMsg counterpart in the Linux kernel. This is the Linux kernel RPMsg and Remoteproc implementation limitation.</p>
<p><img src="imgs/RPMsg-kernel.jpg" alt="RPMsg-kernel"></p>
<h5 id="1412-openamp-rpmsg-implementation-in-linux-userspace">1.4.1.2. OpenAMP RPMsg Implementation in Linux Userspace</h5>
<p>OpenAMP library can also be used in Linux userspace. In this configuration, the remote processor can run independently to the Linux host processor.</p>
<p><img src="imgs/RPMsg-userspace.jpg" alt="RPMsg-userspace"></p>
<h2 id="2-rzg2l&#x65B9;&#x6848;&#x6574;&#x4F53;&#x67B6;&#x6784;">2. RZG2L&#x65B9;&#x6848;&#x6574;&#x4F53;&#x67B6;&#x6784;</h2>
<p>&#x5BF9;&#x4E8E;stm32mp157&#xFF0C;&#x4ED6;&#x7684;M&#x6838;&#x4F7F;&#x7528;&#x4E86;OpenAMP&#x6846;&#x67B6;&#x6765;&#x63D0;&#x4F9B;remoteproc&#x548C;rpmsg&#x529F;&#x80FD;&#xFF0C;&#x5728;Linux&#x7AEF;&#x5219;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528;Liunx&#x5185;&#x6838;&#x63D0;&#x4F9B;&#x7684;&#x76F8;&#x5173;&#x529F;&#x80FD;</p>
<p><img src="imgs/stm32-ipc.png" alt="stm32-ipc.png"></p>
<p>&#x4F46;&#x662F;RZG2L&#x7684;Linux&#x7AEF;&#xFF0C;&#x6CA1;&#x6709;&#x4F7F;&#x7528;Linux&#x5185;&#x6838;&#x4E2D;&#x7684;remoteproc&#x548C;rpmsg&#xFF0C;&#x800C;&#x662F;&#x4F7F;&#x7528;OpenAMP&#x5E93;&#x5B9E;&#x73B0;Remoteproc&#xFF0C;RPMsg&#xFF0C;&#x800C;&#x4E14;&#x5173;&#x4E8E;Remoteproc&#xFF0C;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x8FDC;&#x7A0B;&#x52A0;&#x8F7D;firmware&#x3001;&#x8FDC;&#x7A0B;&#x542F;&#x52A8;&#x5185;&#x6838;&#x76F8;&#x5173;&#x529F;&#x80FD;</p>
<p><img src="imgs/rzg2l-ipc.png" alt="rzg2l-ipc.png"></p>
<ul>
<li>&#x6700;&#x5E95;&#x5C42;&#x662F;UIO/VFIO&#xFF0C;&#x7531;Linux&#x5185;&#x6838;&#x63D0;&#x4F9B;</li>
<li>libmetal&#x4F7F;&#x7528;UIO/VFIO&#x76F8;&#x5173;&#x63A5;&#x53E3;</li>
<li>open-amp&#x4F9D;&#x8D56;&#x4E8E;libmetal&#xFF0C;&#x63D0;&#x4F9B;Remoteproc&#x3001;RPMsg&#x76F8;&#x5173;&#x529F;&#x80FD;</li>
<li>&#x6700;&#x9876;&#x5C42;&#x7684;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F7F;&#x7528;RPMsg&#x76F8;&#x5173;&#x63A5;&#x53E3;&#x5B8C;&#x6210;&#x6838;&#x95F4;&#x901A;&#x4FE1;</li>
</ul>
<p>&#x5728;M33&#x6838;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x5230;&#x4E86;</p>
<ul>
<li>Message Handling Unit (MHU)<ul>
<li>&#x63D0;&#x4F9B;Inter-Processor Interrupt</li>
</ul>
</li>
<li>General Timer (GTM)<ul>
<li>&#x7528;&#x6765;Configures the tick for FreeRTOS.</li>
</ul>
</li>
</ul>
<h2 id="3-a55&#x6838;">3. A55&#x6838;</h2>
<p>&#x5728;A55&#x7AEF;&#x7A0B;&#x5E8F;&#xFF0C;&#x4F9D;&#x8D56;<code>libmetal.so.0.1.0</code>&#x548C;<code>libopen_amp.so.0.1.0</code>&#x5E93;&#xFF0C;&#x6CA1;&#x6709;&#x6E90;&#x7801;&#xFF0C;&#x53EA;&#x6709;&#x5E93;&#x6587;&#x4EF6;&#xFF0C;&#x5728;<code>/opt/poky/3.1.5/sysroots/aarch64-poky-linux/usr/lib64/</code>&#x76EE;&#x5F55;&#x91CC;&#x3002;</p>
<h3 id="31-&#x521D;&#x59CB;&#x5316;">3.1. &#x521D;&#x59CB;&#x5316;</h3>
<ol>
<li>&#x521D;&#x59CB;&#x5316;libmetal&#xFF0C;<code>init_system();</code></li>
<li><code>metal_init(&amp;metal_param);</code></li>
</ol>
<h3 id="32-&#x521B;&#x5EFA;remoteproc">3.2. &#x521B;&#x5EFA;remoteproc</h3>
<p><code>platform_create_proc()</code></p>
<p>&#x6240;&#x8C13;&#x521B;&#x5EFA;remoteproc&#x5C31;&#x662F;&#x586B;&#x5145;<code>struct remoteproc</code>&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x91CC;&#x6709;&#x4E00;&#x4E2A;<code>void *priv;</code>&#x79C1;&#x6709;&#x6570;&#x636E;</p>
<p>&#x8FD9;&#x91CC;&#x7684;&#x79C1;&#x6709;&#x6570;&#x636E;&#x662F;&#x6307;<code>struct remoteproc_priv</code>&#xFF0C;&#x5305;&#x542B;&#x4E09;&#x90E8;&#x5206;</p>
<ul>
<li><code>notify_id</code>&#xFF0C;&#x7528;&#x6765;&#x533A;&#x5206;&#x4E0D;&#x540C;&#x7684;remoteproc</li>
<li><code>mbx_chn_id</code>&#xFF0C;&#x672A;&#x77E5;&#x7528;&#x9014;&#xFF0C;&#x4EE3;&#x7801;&#x4E2D;&#x6CA1;&#x6709;&#x7528;&#x5230;</li>
<li><code>struct vring_info *vr_info</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x91CC;&#x662F;&#x4E09;&#x4E2A;<code>struct shm_info</code>&#xFF0C;&#x63CF;&#x8FF0;&#x4E86;&#x4E09;&#x5757;&#x5171;&#x4EAB;&#x5185;&#x5B58;<ul>
<li><code>rsc</code>&#xFF0C;&#x5BF9;&#x5E94;&#x8BBE;&#x5907;&#x6811;&#x91CC;<code>42f00000.rsctbl</code>&#xFF0C;&#x7528;&#x6765;&#x5B58;&#x653E;&#x8D44;&#x6E90;&#x8868;</li>
<li><code>ctl</code>&#xFF0C;&#x5BF9;&#x5E94;&#x8BBE;&#x5907;&#x6811;&#x91CC;<code>43000000.vring-ctl0</code>&#xFF0C;&#x7528;&#x9014;&#x672A;&#x77E5;</li>
<li><code>shm</code>&#xFF0C;&#x5BF9;&#x5E94;&#x8BBE;&#x5907;&#x6811;&#x91CC;<code>43200000.vring-shm0</code>&#xFF0C;&#x7528;&#x6765;&#x4F20;&#x9012;&#x6570;&#x636E;</li>
</ul>
</li>
</ul>
<p>&#x5728;OpenAMP&#x7684;&#x6846;&#x67B6;&#x4E0B;&#x7F16;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x662F;<code>metal_allocate_memory(sizeof(struct remoteproc));</code>&#x4E3A;remoteproc&#x6307;&#x9488;&#x7533;&#x8BF7;&#x5185;&#x5B58;</p>
<h4 id="321-&#x5BF9;remoteproc&#x521D;&#x59CB;&#x5316;">3.2.1. &#x5BF9;remoteproc&#x521D;&#x59CB;&#x5316;</h4>
<p><code>remoteproc_init(rproc_inst, &amp;rzg2_proc_ops, rproc_priv)</code>&#xFF0C;&#x4F20;&#x5165;&#x64CD;&#x4F5C;&#xFF08;rzg2_proc_ops&#xFF09;&#xFF0C;&#x51FD;&#x6570;&#x6307;&#x9488;&#x3002;</p>
<p>&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x7684;&#x662F;<code>rzg2_proc_init()</code></p>
<ul>
<li>&#x9996;&#x5148;&#x662F;&#x6253;&#x5F00;&#x8BBE;&#x5907;<code>metal_device_open(ipi.bus_name, ipi.name, &amp;dev);</code><ul>
<li>&#x7C7B;&#x4F3C;linux&#x4E2D;&#x7684;&#x64CD;&#x4F5C;&#x6A21;&#x5F0F;&#xFF0C;&#x5148;open&#xFF0C;&#x518D;&#x8FDB;&#x884C;&#x540E;&#x7EED;&#x64CD;&#x4F5C;</li>
<li>open&#x4E2D;&#x4E3B;&#x8981;&#x662F;&#x8FDB;&#x884C;&#x786C;&#x4EF6;&#x914D;&#x7F6E;&#x3001;&#x6253;&#x5F00;ipi&#x8BBE;&#x5907;&#xFF0C;&#x8FD9;&#x91CC;&#x6307;&#x7684;&#x662F;<code>10400000.mbox-uio</code></li>
</ul>
</li>
<li><code>metal_device_io_region()</code><ul>
<li>&#x4F7F;&#x7528;&#x7684;&#x90FD;&#x662F;metal&#x5E93;&#x7684;api&#xFF0C;&#x628A;&#x8FD9;&#x4E2A;&#x8BBE;&#x5907;&#x770B;&#x4F5C;&#x662F;&#x4E00;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x6620;&#x5C04;&#x5230;&#x7528;&#x6237;&#x7A7A;&#x95F4;</li>
<li>&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A;<code>struct metal_io_region *</code>&#xFF0C;&#x662F;&#x8FD9;&#x5757;&#x5185;&#x5B58;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x3001;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7B49;&#x76F8;&#x5173;&#x4FE1;&#x606F;</li>
</ul>
</li>
<li><code>rzg2_enable_interrupt()</code><ul>
<li>&#x5728;&#x8FD9;&#x91CC;&#x8BBE;&#x7F6E;&#x4E2D;&#x65AD;&#x76F8;&#x5173;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5904;&#x7406;&#x6838;&#x95F4;&#x901A;&#x4FE1;&#x65F6;&#x4EA7;&#x751F;&#x7684;&#x4E2D;&#x65AD;&#x4FE1;&#x53F7;&#xFF0C;&#x6CE8;&#x518C;&#x4E2D;&#x65AD;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B49;</li>
</ul>
</li>
<li><code>init_memory_device()</code><ul>
<li>&#x628A;&#x79C1;&#x6709;&#x6570;&#x636E;&#x4E2D;&#x7684;<code>vring_info</code>&#x91CC;&#x9762;&#x7684;&#x5185;&#x5B58;&#x586B;&#x5145;&#x4E0A;&#x5730;&#x5740;&#x4E86;&#xFF0C;&#x4E4B;&#x524D;&#x90FD;&#x662F;null<ul>
<li>vring_info&#x7684;&#x4E09;&#x4E2A;shm_info&#x672C;&#x8D28;&#x90FD;&#x662F;&#x5185;&#x5B58;&#x5757;&#xFF0C;&#x5728;metal&#x6846;&#x67B6;&#x4E0B;&#x8BA4;&#x4E3A;&#x5176;&#x90FD;&#x662F;&#x8BBE;&#x5907;&#xFF1B;&#x5728;&#x8BBE;&#x5907;&#x6811;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x8BBE;&#x5907;</li>
</ul>
</li>
<li>&#x4EE5;&#x5176;&#x4E2D;<code>vring_info-&gt;rsc</code>&#x4E3A;&#x4F8B;<ul>
<li><code>ret = metal_device_open(info-&gt;bus_name, info-&gt;name, &amp;dev);</code> &#x5148;&#x6253;&#x5F00;&#x8BBE;&#x5907;<code>42f00000.rsctbl</code></li>
<li><code>info-&gt;io = metal_device_io_region(dev, 0x0U);</code> &#x8FD9;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x83B7;&#x53D6; &#x5185;&#x5B58;&#x533A;&#x5757;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x53E5;&#x67C4;&#xFF1F;</li>
<li><code>remoteproc_init_mem()</code>&#x521D;&#x59CB;&#x5316;&#x8FD9;&#x5757;&#x5185;&#x5B58;</li>
<li><code>remoteproc_add_mem()</code>&#xFF0C;&#x628A;&#x8FD9;&#x5757;&#x5185;&#x5B58;&#x6DFB;&#x52A0;&#x5230;remoteproc&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x628A;&#x8FD9;&#x5757;&#x5185;&#x5B58;&#x4EA4;&#x7531;remoteproc&#x7BA1;&#x7406;&#xFF0C;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="322-&#x5904;&#x7406;&#x8D44;&#x6E90;&#x8868;">3.2.2. &#x5904;&#x7406;&#x8D44;&#x6E90;&#x8868;</h4>
<p>&#x8D44;&#x6E90;&#x8868;&#x662F;&#x7528;&#x6765;&#x63CF;&#x8FF0;cm33&#x90FD;&#x6709;&#x54EA;&#x4E9B;&#x8D44;&#x6E90;&#x7684;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;cm33&#x7684;&#x81EA;&#x8EAB;&#x5C5E;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x653E;&#x5230;cm33&#x7684;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x7531;CM33&#x6838;&#x7684;&#x7A0B;&#x5E8F;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x5E76;&#x5B58;&#x653E;&#x5728;<code>42f00000.rsctbl</code>&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E2D;</p>
<p>A55&#x6838;&#x60F3;&#x8981;&#x4F7F;&#x7528;cm33&#x6838;&#xFF0C;&#x9700;&#x8981;&#x77E5;&#x9053;cm33&#x6709;&#x54EA;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x5728;A55&#x4E2D;&#x8BFB;&#x8D44;&#x6E90;&#x8868;&#x3002;</p>
<p>&#x9700;&#x8981;&#x5148;&#x6620;&#x5C04;&#x8FD9;&#x6BB5;&#x5185;&#x5B58;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x5230;&#x865A;&#x62DF;&#x5730;&#x5740;&#xFF08;MMU&#xFF09;</p>
<p><code>rsc_table = remoteproc_mmap(rproc_inst, &amp;pa, NULL, rsc_size, 0, NULL);</code></p>
<p>&#x4E4B;&#x540E;<code>ret = remoteproc_set_rsc_table(rproc_inst, rsc_table, rsc_size);</code>&#xFF0C;&#x89E3;&#x6790;&#x8D44;&#x6E90;&#x8868;&#xFF0C;&#x5E76;&#x628A;&#x6570;&#x636E;&#x4FDD;&#x5B58;&#x5230;remoteproc&#x4E2D;&#xFF0C;&#x8FD9;&#x6837;a55&#x5C31;&#x77E5;&#x9053;cm33&#x6709;&#x54EA;&#x4E9B;&#x8D44;&#x6E90;&#x53EF;&#x7528;&#x4E86;</p>
<h3 id="33-&#x521B;&#x5EFA;rpmsg-device">3.3. &#x521B;&#x5EFA;RPMsg device</h3>
<pre><code class="lang-c">
/**
 * struct rpmsg_virtio_device - representation of a rpmsg device based on virtio
 * @rdev: rpmsg device, first property in the struct
 * @vdev: pointer to the virtio device
 * @rvq: pointer to receive virtqueue
 * @svq: pointer to send virtqueue
 * @shbuf_io: pointer to the shared buffer I/O region
 * @shpool: pointer to the shared buffers pool
 * @endpoints: list of endpoints.
 */
struct rpmsg_virtio_device {
  struct rpmsg_device rdev;
  struct virtio_device *vdev;
  struct virtqueue *rvq;
  struct virtqueue *svq;
  struct metal_io_region *shbuf_io;
  struct rpmsg_virtio_shm_pool *shpool;
};

struct  rpmsg_device *
platform_create_rpmsg_vdev(void *platform, unsigned int vdev_index,
               unsigned int role,
               void (*rst_cb)(struct virtio_device *vdev),
               rpmsg_ns_bind_cb ns_bind_cb);
</code></pre>
<p><code>platform_create_rpmsg_vdev()&#xFF1B;</code>&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;<code>struct rpmsg_device *</code>&#xFF0C;&#x8FD9;&#x4E2A;&#x76F8;&#x5F53;&#x4E8E;&#x57FA;&#x7C7B;&#x6307;&#x9488;&#xFF0C;&#x4F46;&#x662F;&#x540E;&#x7EED;&#x771F;&#x6B63;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9700;&#x8981;&#x628A;&#x4ED6;&#x76F4;&#x63A5;&#x5F3A;&#x5236;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x5230;<code>struct rpmsg_virtio_device *</code></p>
<p>&#x5728;<code>rpmsg_virtio_device</code>&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5C31;&#x662F;<code>rpmsg_device</code>&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EEC;&#x7684;&#x5730;&#x5740;&#x662F;&#x76F8;&#x540C;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5F3A;&#x5236;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x3002;</p>
<h4 id="331-&#x521B;&#x5EFA;virtio&#x8BBE;&#x5907;">3.3.1. &#x521B;&#x5EFA;virtio&#x8BBE;&#x5907;</h4>
<pre><code class="lang-c">/* remoteproc_create_virtio
 *
 * create virtio device, it returns pointer to the created virtio device.
 *
 * @rproc: pointer to the remoteproc instance
 * @vdev_id: virtio device ID
 * @role: virtio device role
 * @rst_cb: virtio device reset callback
 *
 * return pointer to the created virtio device, NULL for failure.
 */
struct virtio_device *
remoteproc_create_virtio(struct remoteproc *rproc,
       int vdev_id, unsigned int role,
       void (*rst_cb)(struct virtio_device *vdev));
</code></pre>
<h5 id="3311-&#x548C;g2l&#x76F8;&#x6096;&#x7684;&#x90E8;&#x5206;">3.3.1.1. &#x548C;G2L&#x76F8;&#x6096;&#x7684;&#x90E8;&#x5206;</h5>
<p>RPMsg&#x662F;&#x57FA;&#x4E8E;virtio&#x7684;messaging bus&#xFF0C;&#x5141;&#x8BB8;&#x672C;&#x5730;&#x5904;&#x7406;&#x5668;&#x548C;&#x8FDC;&#x7A0B;&#x5904;&#x7406;&#x5668;&#x8FDB;&#x884C;&#x4EA4;&#x6D41;&#x3002;&#x5B83;&#x662F;&#x7528;<code>virtio vring</code>&#x5728;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E0A;&#x53D1;&#x9001;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x7684;&#x3002;&#x5177;&#x4F53;&#x800C;&#x8A00;&#xFF0C;<code>vring</code>&#x662F;&#x5355;&#x5411;&#x7684;&#xFF0C;&#x603B;&#x5171;&#x9700;&#x8981;&#x5F00;&#x4E24;&#x4E2A;&#x5B9E;&#x73B0;&#x53CC;&#x5411;&#x4F20;&#x8F93;&#xFF0C;&#x5728;&#x4E24;&#x4E2A;&#x5904;&#x7406;&#x5668;&#x90FD;&#x80FD;&#x770B;&#x5230;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x4E0A;&#x4F1A;&#x5F00;&#x8F9F;&#x5171;&#x4EAB;&#x7684;buffer&#x3002;&#x4F7F;&#x7528;IPI&#x6765;&#x901A;&#x77E5;&#x5904;&#x7406;&#x5668;&#x5728;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E2D;&#x6709;&#x5F85;&#x8BFB;&#x53D6;&#x7684;&#x6570;&#x636E;&#x3002;</p>
<pre><code class="lang-c"><span class="hljs-comment">/*
* Channel direction and usage:
*
*  ========   &lt;-- new msg ---=============--------&lt;------   =======
* ||      ||                || CHANNEL 1 ||                ||     ||
* || A55  ||  -------&gt;-------=============--- buf free--&gt;  || M33 ||
* ||      ||                                               ||     ||
* ||master||  &lt;-- buf free---=============--------&lt;------  ||slave||
* ||      ||                || CHANNEL 2 ||                ||     ||
*  ========   -------&gt;-------=============----new msg --&gt;   =======
*/</span>
</code></pre>
<p>A55&#x662F;master&#xFF08;VIRTIO_DEV_MASTER&#xFF09;&#xFF0C;CM33&#x662F;slave&#xFF08;VIRTIO_DEV_SLAVE&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x76EE;&#x524D;&#x53EA;&#x770B;&#x5230;&#x4E86;&#x4E00;&#x4E2A;virtio&#x8BBE;&#x5907;&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x8FF0;&#x8BF4;&#x6CD5;&#xFF0C;&#x53EA;&#x80FD;&#x8FDB;&#x884C;&#x5355;&#x5411;&#x901A;&#x4FE1;&#xFF0C;&#x4F46;&#x662F;&#x76EE;&#x524D;&#x597D;&#x50CF;&#x662F;&#x80FD;&#x53CC;&#x5411;&#x901A;&#x4FE1;&#xFF0C;</p>
<ul>
<li>&#x6216;&#x8005;&#x8BF4;&#xFF0C;&#x4E4B;&#x524D;&#x5BF9;&#x7A0B;&#x5E8F;&#x7406;&#x89E3;&#x6709;&#x8BEF;&#xFF0C;&#x5C31;&#x662F;&#x5728;&#x8FDB;&#x884C;&#x5355;&#x5411;&#x901A;&#x4FE1;&#xFF1F;</li>
<li>&#x6216;&#x8005;&#x662F;&#xFF0C;&#x518D;&#x4EC0;&#x4E48;&#x5730;&#x65B9;&#x8FDB;&#x884C;&#x4E86;&#x53E6;&#x4E00;&#x4E2A;&#x65B9;&#x5411;&#x7684;virtio&#x8BBE;&#x5907;&#x521B;&#x5EFA;&#xFF1F;</li>
<li>&#x6216;&#x8005;&#x662F;&#xFF0C;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;virtio&#x8BBE;&#x5907;&#x548C;&#x4E0A;&#x8FF0;&#x7684;channel&#x4E0D;&#x662F;&#x5BF9;&#x5E94;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;virtio&#x80FD;&#x8FDB;&#x884C;&#x53CC;&#x5411;&#x901A;&#x4FE1;&#xFF1F;</li>
</ul>
<h4 id="332-&#x5904;&#x7406;vrinfo-shmio">3.3.2. &#x5904;&#x7406;<code>vr_info-&gt;shm.io</code></h4>
<p>&#x5728;&#x521B;&#x5EFA;remoteproc&#x7684;&#x65F6;&#x5019;&#x5DF2;&#x7ECF;&#x5BF9;&#x79C1;&#x6709;&#x6570;&#x636E;&#x4E2D;&#x7684;vr_info-&gt;shm.io&#x8FD9;&#x4E2A;region&#x521D;&#x59CB;&#x5316;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x4ED6;&#x4EE3;&#x8868;&#x7684;&#x5C31;&#x662F;<code>43200000.vring-shm0</code>&#x8FD9;&#x5757;&#x5185;&#x5B58;&#x3002;</p>
<pre><code class="lang-c">pa = metal_io_phys(prproc-&gt;vr_info-&gt;shm.io, <span class="hljs-number">0x0</span>U);  <span class="hljs-comment">//&#x6839;&#x636E;&#x8FD9;&#x4E00;&#x4E2A;&#x6574;&#x4E2A;&#x7684;&#x5185;&#x5B58;&#x5757;&#x548C;offset&#xFF0C;&#x8BA1;&#x7B97;&#x51FA;&#x60F3;&#x8981;&#x4F7F;&#x7528;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x3002;</span>
shbuf_io = remoteproc_get_io_with_pa(rproc, pa);  <span class="hljs-comment">//&#x6839;&#x636E;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF0C;&#x518D;&#x8F6C;&#x6362;&#x5230;&#x6307;&#x5411;&#x76F8;&#x5E94;&#x7684;&#x5185;&#x5B58;struct metal_io_region *</span>
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7ECF;&#x8FC7;&#x8F6C;&#x6362;&#x662F;&#x4E3A;&#x4E86;&#x6709;&#x4E9B;&#x573A;&#x666F;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x5BF9;&#x8FD9;&#x4E00;&#x5927;&#x5757;&#x5185;&#x5B58;region&#x5206;&#x5757;&#x4F7F;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x6839;&#x636E;offset&#x786E;&#x5B9A;&#x771F;&#x6B63;&#x7528;&#x7684;region&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x91CC;&#x662F;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7684;&#x4E00;&#x6574;&#x5757;&#xFF0C;offset&#x4E3A;0&#xFF0C;&#x6700;&#x540E;<code>prproc-&gt;vr_info-&gt;shm.io</code>&#x548C;<code>shbuf_io</code>&#x6307;&#x5411;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;</p>
<pre><code class="lang-c">LPRINTF(<span class="hljs-string">&quot;initializing rpmsg shared buffer pool\n&quot;</span>);
shbuf = metal_io_phys_to_virt(shbuf_io, pa);        <span class="hljs-comment">//&#x628A;&#x7269;&#x7406;&#x5730;&#x5740;&#x8F6C;&#x6362;&#x5230;&#x865A;&#x62DF;&#x5730;&#x5740;&#xFF08;MMU&#x8F6C;&#x6362;&#xFF09;&#xFF0C;&#x5728;linux&#x4E2D;&#x5BF9;&#x5185;&#x5B58;&#x7684;&#x8BBF;&#x95EE;&#x90FD;&#x9700;&#x8981;&#x7ECF;&#x8FC7;MMU&#x6620;&#x5C04;</span>
len = metal_io_region_size(prproc-&gt;vr_info-&gt;shm.io);
rpmsg_virtio_init_shm_pool(&amp;shpool, shbuf, len);    <span class="hljs-comment">//&#x586B;&#x5145; shpool &#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x5305;&#x542B;&#x5185;&#x5B58;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x3001;&#x53EF;&#x7528;&#x5927;&#x5C0F;&#x3001;&#x603B;&#x5927;&#x5C0F;&#x3002;</span>
</code></pre>
<p>&#x5904;&#x7406;&#x4E4B;&#x540E;&#x5F97;&#x5230;&#x4E00;&#x4E2A;<code>struct rpmsg_virtio_shm_pool</code>&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x6C60;&#xFF0C;&#x4E4B;&#x540E;&#x7684;&#x6838;&#x95F4;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x90FD;&#x9700;&#x8981;&#x901A;&#x8FC7;shpool&#x4F20;&#x8F93;&#x3002;</p>
<pre><code class="lang-c"><span class="hljs-comment">/**
 * struct rpmsg_virtio_shm_pool - shared memory pool used for rpmsg buffers
 * @get_buffer: function to get buffer from the pool
 * @base: base address of the memory pool
 * @avail: available memory size
 * @size: total pool size
 */</span>
<span class="hljs-keyword">struct</span> rpmsg_virtio_shm_pool {
  <span class="hljs-keyword">void</span> *base;
  <span class="hljs-keyword">size_t</span> avail;
  <span class="hljs-keyword">size_t</span> size;
};

<span class="hljs-keyword">struct</span> rpmsg_virtio_shm_pool shpool;
</code></pre>
<h4 id="333-&#x521D;&#x59CB;&#x5316;rpmsgvdev">3.3.3. &#x521D;&#x59CB;&#x5316;rpmsg_vdev</h4>
<pre><code class="lang-c">rpmsg_init_vdev(rpmsg_vdev, vdev, ns_bind_cb, shbuf_io, &amp;shpool); <span class="hljs-comment">//&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;rpmsg virtio device&#x8BBE;&#x5907;</span>
</code></pre>
<p>&#x8FD9;&#x91CC;&#x7684;<code>ns_bind_cb</code>&#x662F;&#x4E00;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x8D1F;&#x8D23;&#x6839;&#x636E;<code>name server</code>&#x521B;&#x5EFA;<code>end point</code>&#xFF0C;&#x4F46;&#x662F;&#x76EE;&#x524D;&#x901A;&#x8FC7;&#x5B83;&#x521B;&#x5EFA;&#x7684;ept&#x90FD;&#x4E0D;&#x80FD;&#x6B63;&#x5E38;&#x901A;&#x4FE1;&#x3002;</p>
<h3 id="34-app">3.4. app</h3>
<p>&#x5728;&#x8FD9;&#x91CC;&#x8FDB;&#x884C;&#x771F;&#x6B63;&#x6570;&#x636E;&#x53D1;&#x9001;&#x76F8;&#x5173;&#x5185;&#x5BB9;&#xFF0C;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x5B8C;&#x6210;&#x4E86;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E86;&#x6838;&#x95F4;&#x901A;&#x4FE1;&#x7684;&#x524D;&#x63D0;&#x3002;rpmsg&#x901A;&#x4FE1;&#x662F;&#x4E00;&#x4E2A;udp-like&#x901A;&#x4FE1;&#x534F;&#x8BAE;&#xFF0C;&#x5230;&#x8FD9;&#x76F8;&#x5F53;&#x4E8E;&#x5EFA;&#x7ACB;&#x4E86;&#x4E24;&#x4E2A;&#x8BBE;&#x5907;&#x4E4B;&#x95F4;&#x7684;ip&#x8FDE;&#x63A5;&#xFF0C;&#x63A5;&#x4E0B;&#x9700;&#x8981;&#x6839;&#x636E;&#x4E0D;&#x540C;app&#x9009;&#x62E9;&#x76F8;&#x5E94;&#x7AEF;&#x53E3;(endpoint)</p>
<h4 id="341-&#x6784;&#x9020;payload">3.4.1. &#x6784;&#x9020;payload</h4>
<p>&#x7533;&#x8BF7;&#x6D88;&#x606F;&#x4F53;&#x9700;&#x8981;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x8FD9;&#x91CC;&#x76F4;&#x63A5;&#x6839;&#x636E;<code>rpmsg_virtio_get_buffer_size()</code>&#x7533;&#x8BF7;&#x7A7A;&#x95F4;&#x3002;</p>
<pre><code class="lang-c"><span class="hljs-comment">/**
 * rpmsg_virtio_get_buffer_size - get rpmsg virtio buffer size
 *
 * @rdev - pointer to the rpmsg device
 *
 * @return - next available buffer size for text, negative value for failure
 */</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">rpmsg_virtio_get_buffer_size</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> rpmsg_device *rdev)</span></span>;
</code></pre>
<p>&#x67D4;&#x6027;&#x6570;&#x7EC4;</p>
<h4 id="342-&#x521B;&#x5EFA;endpoint">3.4.2. &#x521B;&#x5EFA;endpoint</h4>
<pre><code class="lang-c"><span class="hljs-comment">/* Create RPMsg endpoint */</span>
<span class="hljs-keyword">if</span> (svcno == <span class="hljs-number">0</span>) {
  svc_name = (<span class="hljs-keyword">char</span> *)CFG_RPMSG_SVC_NAME0;
} <span class="hljs-keyword">else</span> {
  svc_name = (<span class="hljs-keyword">char</span> *)CFG_RPMSG_SVC_NAME1;
}
ret = rpmsg_create_ept(&amp;rp_ept, rdev, svc_name, APP_EPT_ADDR,
                RPMSG_ADDR_ANY,
                rpmsg_service_cb0, rpmsg_service_unbind);
</code></pre>
<ul>
<li><code>rp_ept</code>&#xFF0C;&#x521B;&#x5EFA;&#x7684;ept</li>
<li><code>rdev</code>&#xFF0C;<code>struct rpmsg_device *</code>&#x7ED3;&#x6784;&#x4F53;&#x6307;&#x9488;&#xFF0C;rpmsg&#x8BBE;&#x5907;</li>
<li><code>svc_name</code>&#x7AEF;&#x53E3;&#x7684;&#x540D;&#x5B57;&#xFF0C;&#x901A;&#x4FE1;&#x53CC;&#x65B9;&#x4E24;&#x4E2A;&#x7AEF;&#x53E3;&#x540D;&#x5B57;&#x5E94;&#x5F53;&#x4E00;&#x81F4;</li>
<li><code>APP_EPT_ADDR</code>&#x662F;&#x672C;&#x673A;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5373;A55&#x7AEF;&#x5730;&#x5740;&#x3002;rpmsg&#x901A;&#x4FE1;&#x9700;&#x8981;&#x53CC;&#x65B9;&#x90FD;&#x521B;&#x5EFA;ept&#xFF0C;&#x76EE;&#x7684;&#x5730;&#x5740;&#x6E90;&#x5730;&#x5740;&#x8981;&#x4E92;&#x76F8;&#x5BF9;&#x5E94;&#x3002;</li>
<li><code>RPMSG_ADDR_ANY</code>&#x662F;&#x5BF9;&#x65B9;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;<code>0xFFFFFFFF</code><ul>
<li>&#x5F53;&#x76EE;&#x7684;&#x5730;&#x5740;&#x662F;<code>0xFFFFFFFF</code>&#x65F6;&#xFF0C;&#x4F1A;&#x6839;&#x636E;&#x540D;&#x5B57;&#x5728;channel&#x5185;&#x8FDB;&#x884C;&#x5E7F;&#x64AD;&#xFF0C;&#x67E5;&#x8BE2;&#x5BF9;&#x65B9;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x7C7B;&#x4F3C;arp</li>
<li>&#x5F53;&#x6E90;&#x5730;&#x5740;&#x662F;<code>0xFFFFFFFF</code>&#x65F6;&#xFF0C;&#x4F1A;&#x81EA;&#x52A8;&#x6839;&#x636E;&#x7AEF;&#x53E3;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x5360;&#x7528;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x7C7B;&#x4F3C;dhcp</li>
<li>&#x8FD9;&#x91CC;&#x8BF4;<code>&#x5730;&#x5740;</code>&#x4E0D;&#x51C6;&#x786E;&#xFF0C;&#x901A;&#x4FE1;&#x7684;&#x65F6;&#x5019;&#xFF0C;A55&#x6838;&#x548C;CM33&#x6838;&#x7AEF;&#x7A0B;&#x5E8F;&#x5730;&#x5740;&#x90FD;&#x8BBE;&#x7F6E;&#x4E3A;0&#xFF0C;&#x4E5F;&#x80FD;&#x6B63;&#x5E38;&#x901A;&#x4FE1;&#xFF0C;&#x7528;&#x7AEF;&#x53E3;&#x6BD4;&#x8F83;&#x597D;<ul>
<li>rpmsg&#x8BBE;&#x5907;&#x5BF9;&#x5E94;&#x4E00;&#x6761;&#x5EFA;&#x7ACB;&#x597D;&#x7684;ip&#x6570;&#x636E;&#x901A;&#x9053;&#xFF08;&#x76F8;&#x5F53;&#x4E8E;&#x5EFA;&#x7ACB;&#x4E86;&#x8DEF;&#x7531;&#x5173;&#x7CFB;&#xFF09;</li>
<li>src&#x548C;dest&#x5BF9;&#x5E94; &#x7AEF;&#x53E3;&#x53F7;</li>
<li>rpmsg&#x8BBE;&#x5907;&#x52A0;&#x4E0A;src&#x548C;dest&#xFF0C;&#x7EC4;&#x5408;&#x4E4B;&#x540E;&#xFF0C;&#x7C7B;&#x4F3C;socket</li>
</ul>
</li>
</ul>
</li>
<li><code>rpmsg_service_cb0</code>&#xFF0C;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x4E4B;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;</li>
<li><code>rpmsg_service_unbind0</code>&#xFF0C;&#x901A;&#x4FE1;&#x7ED3;&#x675F;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;</li>
</ul>
<h4 id="343-poll">3.4.3. poll</h4>
<pre><code class="lang-c"><span class="hljs-keyword">while</span> (!is_rpmsg_ept_ready(&amp;rp_ept)) <span class="hljs-comment">//&#x7B49;&#x5F85;&#x6E90;&#x5730;&#x5740;&#x548C;&#x76EE;&#x7684;&#x5730;&#x5740;&#x90FD;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x6210;&#x529F;</span>
    platform_poll(priv);    <span class="hljs-comment">//poll&#x673A;&#x5236;  //priv&#x662F;&#x4E4B;&#x524D;&#x521B;&#x5EFA;&#x7684;remoteproc&#x7ED3;&#x6784;&#x4F53;&#x6307;&#x9488;</span>

LPRINTF(<span class="hljs-string">&quot;RPMSG service has created.\n&quot;</span>);

<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, size = pi.min; i &lt; (<span class="hljs-keyword">int</span>)pi.num; i++, size++) {
  i_payload-&gt;num = i;
  i_payload-&gt;size = size;

  <span class="hljs-comment">/* Mark the data buffer. */</span>
  <span class="hljs-built_in">memset</span>(&amp;(i_payload-&gt;data[<span class="hljs-number">0</span>]), <span class="hljs-number">0xA5</span>, size);

  LPRINTF(<span class="hljs-string">&quot;sending payload number %lu of size %lu\n&quot;</span>,
        i_payload-&gt;num, (<span class="hljs-number">2</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)) + size);

  ret = rpmsg_send(&amp;rp_ept, i_payload, (<span class="hljs-number">2</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)) + size); <span class="hljs-comment">//&#x53D1;&#x9001;</span>

  <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) {
    LPRINTF(<span class="hljs-string">&quot;Error sending data...%d\n&quot;</span>, ret);
    <span class="hljs-keyword">break</span>;
  }
  LPRINTF(<span class="hljs-string">&quot;echo test: sent : %lu\n&quot;</span>, (<span class="hljs-number">2</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span>)) + size);

  expect_rnum++;
  <span class="hljs-keyword">do</span> {
    platform_poll(priv);  <span class="hljs-comment">//poll</span>
  } <span class="hljs-keyword">while</span> ((rnum &lt; expect_rnum) &amp;&amp; !err_cnt);
  usleep(<span class="hljs-number">10000</span>);
}

LPRINTF(<span class="hljs-string">&quot;************************************\n&quot;</span>);
LPRINTF(<span class="hljs-string">&quot; Test Results: Error count = %d \n&quot;</span>, err_cnt);
LPRINTF(<span class="hljs-string">&quot;************************************\n&quot;</span>);
</code></pre>
<h2 id="4-cm33&#x6838;">4. CM33&#x6838;</h2>
<h3 id="41-&#x6784;&#x5EFA;&#x9879;&#x76EE;">4.1. &#x6784;&#x5EFA;&#x9879;&#x76EE;</h3>
<p>CM33&#x7AEF;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x5728;FreeRTOS&#x4E4B;&#x4E0A;&#x7684;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;OpenAMP&#x6846;&#x67B6;&#x4F5C;&#x4E3A;&#x591A;&#x6838;&#x901A;&#x4FE1;&#x57FA;&#x7840;</p>
<p>&#x8FD0;&#x884C;&#x4E24;&#x4E2A;task&#xFF0C;&#x5206;&#x522B;&#x662F;<code>blinky_thread_entry.c</code>&#x548C;<code>MainTask_entry.c</code>&#xFF0C;&#x63A7;&#x5236;LED&#x548C;&#x901A;&#x4FE1;</p>
<p>&#x4EE3;&#x7801;&#x6846;&#x67B6;&#x7531;e2stdio&#x751F;&#x6210;</p>
<h4 id="411-&#x9879;&#x76EE;&#x7ED3;&#x6784;">4.1.1. &#x9879;&#x76EE;&#x7ED3;&#x6784;</h4>
<ul>
<li><code>Debug/</code> &#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;&#x4E2D;&#x751F;&#x6210;&#x7684;&#x4E2D;&#x95F4;&#x6587;&#x4EF6;&#x3001;&#x6700;&#x7EC8;&#x7684;elf&#x6587;&#x4EF6;&#x3001;&#x5206;&#x6BB5;&#x4E4B;&#x540E;&#x7684;&#x7A0B;&#x5E8F;</li>
<li><code>rzg/</code><ul>
<li><code>arm/</code> arm&#x5185;&#x6838;&#x542F;&#x52A8;&#x6587;&#x4EF6;</li>
<li><code>aws/</code> FreeRTOS&#x76F8;&#x5173;&#x6587;&#x4EF6;</li>
<li><code>board/</code> &#x677F;&#x5B50;&#x76F8;&#x5173;&#xFF0C;&#x8FD9;&#x90E8;&#x5206;&#x4E0D;&#x4F1A;&#x6839;&#x636E;<code>configuration.xml</code>&#x914D;&#x7F6E;&#x6587;&#x6863;&#x81EA;&#x52A8;&#x53D8;&#x5316;<ul>
<li><code>rzg2l_smarc/board_leds.c</code> &#x6838;&#x5FC3;&#x677F;&#x7684;LED</li>
<li><code>rzg2l_smarc/pin_data.c</code> &#x5F15;&#x811A;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF08;SCIF&#xFF09;</li>
</ul>
</li>
<li><code>fsp/</code> &#x5916;&#x8BBE;&#x7684;&#x9A71;&#x52A8;&#x6587;&#x4EF6;</li>
<li><code>linaro/</code> libmetal&#x3001;open-amp</li>
</ul>
</li>
<li><code>rzg_cfg/</code> freertos&#x7B49;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</li>
<li><code>rzg_gen/</code> &#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x6846;&#x67B6;&#xFF0C;&#x5305;&#x542B;main.c</li>
<li><code>script/</code> &#x94FE;&#x63A5;&#x811A;&#x672C;</li>
<li><code>src/</code> &#x7528;&#x6237;&#x4EE3;&#x7801;</li>
<li><code>configuration.xml</code></li>
<li><code>after_build.bat</code></li>
</ul>
<h4 id="412-&#x914D;&#x7F6E;&#x529F;&#x80FD;">4.1.2. &#x914D;&#x7F6E;&#x529F;&#x80FD;</h4>
<p>&#x6253;&#x5F00;<code>configuration.xml</code>&#x6587;&#x4EF6;&#x4E4B;&#x540E;&#xFF0C;&#x9009;&#x62E9;<code>FSP Configuration</code>&#x89C6;&#x56FE;&#x5373;&#x53EF;&#x914D;&#x7F6E;&#x9879;&#x76EE;</p>
<p><img src="imgs/e2stdio-cm33-project-tree.png" alt="e2stdio-cm33-project-tree.png"></p>
<p><img src="imgs/e2stdio-generate-pro.png" alt="e2stdio-generate-pro.png"></p>
<p>&#x5982;&#x56FE;&#xFF0C;&#x53EF;&#x5728;<code>New Stack</code>&#x6DFB;&#x52A0;&#x76F8;&#x5E94;&#x529F;&#x80FD;&#xFF0C;&#x5728;<code>&#x5C5E;&#x6027;</code>&#x9762;&#x677F;&#x4E2D;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x76F8;&#x5173;&#x5C5E;&#x6027;&#xFF0C;&#x4FDD;&#x5B58;&#x4E4B;&#x540E;<code>Genetate Project Content</code>&#x751F;&#x6210;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x9879;&#x76EE;&#x3002;</p>
<p><code>rzg_gen/</code>&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x6587;&#x4EF6;&#x90FD;&#x662F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#xFF0C;&#x6700;&#x597D;&#x4E0D;&#x8981;&#x76F4;&#x63A5;&#x4FEE;&#x6539;&#x91CC;&#x9762;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5426;&#x5219;&#x4E0B;&#x4E00;&#x6B21;<code>Genetate Project Content</code>&#x4E4B;&#x540E;&#x4F1A;&#x8986;&#x76D6;&#x4E4B;&#x524D;&#x7684;&#x4FEE;&#x6539;&#x3002;</p>
<p>&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x6587;&#x4EF6;&#x7B2C;&#x4E00;&#x884C;&#x6709;&#x76F8;&#x5173;&#x6CE8;&#x91CA;</p>
<pre><code class="lang-c"><span class="hljs-comment">/* generated main source file - do not edit */</span>
</code></pre>
<h3 id="42-&#x5173;&#x4E8E;scif">4.2. &#x5173;&#x4E8E;SCIF</h3>
<p>&#x5BF9;&#x4E8E;FreeRTOS&#x800C;&#x8A00;&#xFF0C;&#x4E0D;&#x50CF;linux&#x9A71;&#x52A8;&#x6846;&#x67B6;&#x90A3;&#x6837;&#x6709;&#x4E30;&#x5BCC;&#x7684;&#x5B50;&#x7CFB;&#x7EDF;&#xFF0C;&#x914D;&#x7F6E;&#x5916;&#x8BBE;&#x8D44;&#x6E90;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;&#x76F8;&#x5BF9;&#x6765;&#x8BF4;&#x6BD4;&#x8F83;&#x5E95;&#x5C42;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;SCIF&#x5916;&#x8BBE;&#xFF0C;&#x9700;&#x8981;&#x4ECE;&#x51E0;&#x4E2A;&#x65B9;&#x9762;&#x914D;&#x7F6E;&#x76F8;&#x5173;&#x529F;&#x80FD;</p>
<ul>
<li>SCIF&#x5BF9;&#x5E94;&#x7684;GPIO&#x76F8;&#x5173;&#x914D;&#x7F6E;</li>
<li>SCIF&#x7684;&#x65F6;&#x949F;&#x3001;&#x590D;&#x4F4D;</li>
<li>SCIF&#x529F;&#x80FD;&#x7684;&#x76F8;&#x5173;&#x5BC4;&#x5B58;&#x5668;</li>
</ul>
<h4 id="421-gpio">4.2.1. GPIO</h4>
<p>GPIO&#x7684;&#x529F;&#x80FD;&#x5305;&#x62EC;&#x529F;&#x80FD;&#x590D;&#x7528;&#x3001;&#x7535;&#x6C14;&#x5C5E;&#x6027;&#x3001;&#x6EE4;&#x6CE2;&#x7B49;</p>
<pre><code class="lang-c"><span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint8_t</span>  * p_pmc;        <span class="hljs-comment">//&#x6A21;&#x5F0F;&#x9009;&#x62E9;&#xFF0C;GPIO or Peripheral</span>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint32_t</span> * p_iolh;       <span class="hljs-comment">//&#x9A71;&#x52A8;&#x80FD;&#x529B;</span>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint32_t</span> * p_sr;         <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x538B;&#x6446;&#x7387;</span>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint32_t</span> * p_pupd;       <span class="hljs-comment">//&#x4E0A;&#x3001;&#x4E0B;&#x62C9;</span>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint32_t</span> * p_filonoff;   <span class="hljs-comment">//&#x6570;&#x5B57;&#x566A;&#x58F0;&#x6EE4;&#x6CE2;</span>
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint32_t</span> * p_filnum;     
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint32_t</span> * p_filclksel;
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">uint32_t</span> * p_pfc;        <span class="hljs-comment">//&#x590D;&#x7528;&#x529F;&#x80FD;&#x9009;&#x62E9;</span>
</code></pre>
<p>&#x53E6;&#x5916;&#xFF0C;Port Function Control Register (PFCm)&#x5BC4;&#x5B58;&#x5668;&#x6709;&#x5199;&#x4FDD;&#x62A4;</p>
<p><img src="imgs/GPIO-PFCm.png" alt="GPIO-PFCm.png"></p>
<h5 id="4211-&#x6B67;&#x8DEF;">4.2.1.1. &#x6B67;&#x8DEF;</h5>
<p>&#x5F00;&#x53D1;&#x677F;&#x4E0A;SCIF2&#x8F6C;&#x6362;&#x6210;&#x4E86;RS485&#x7535;&#x5E73;&#xFF0C;SCIF1&#x662F;TTL&#x7535;&#x5E73;&#xFF0C;&#x745E;&#x8428;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;<code>rzg2l_cm33_rpmsg_demo</code>&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x662F;SCIF2</p>
<p>&#x5728;<code>configuration.xml</code>&#x4E2D;&#x6539;&#x6210;SCIF1&#x4E4B;&#x540E;&#xFF0C;&#x9ED8;&#x8BA4;<code>rzg\board\rzg2l_smarc\pin_data.c</code>&#x4E2D;&#x8BBE;&#x7F6E;&#x7684;&#x662F;SCIF2&#x7684;&#x5F15;&#x811A;&#xFF0C;&#x6CA1;&#x6709;&#x81EA;&#x52A8;&#x4FEE;&#x6539;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x76F4;&#x6CA1;&#x6709;&#x6CE2;&#x5F62;</p>
<pre><code class="lang-c"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span>
{

  ...

  <span class="hljs-keyword">union</span>
  {
    __IOM <span class="hljs-keyword">uint16_t</span> PM38;
    <span class="hljs-keyword">struct</span>
    {
      __IOM <span class="hljs-keyword">uint8_t</span> L;
      __IOM <span class="hljs-keyword">uint8_t</span> H;
    } PM38_byte;
    <span class="hljs-keyword">struct</span>
    {
      __IOM <span class="hljs-keyword">uint8_t</span> PM38_0 : <span class="hljs-number">2</span>;
      __IOM <span class="hljs-keyword">uint8_t</span> PM38_1 : <span class="hljs-number">2</span>;
      __IOM <span class="hljs-keyword">uint8_t</span> PM38_2 : <span class="hljs-number">2</span>;
      <span class="hljs-keyword">uint8_t</span>              : <span class="hljs-number">2</span>;
      <span class="hljs-keyword">uint8_t</span>              : <span class="hljs-number">8</span>;
    } PM38_b;
  };

  ...

  <span class="hljs-keyword">union</span>
  {
    __IOM <span class="hljs-keyword">uint8_t</span> PMC38;
    <span class="hljs-keyword">struct</span>
    {
      __IOM <span class="hljs-keyword">uint8_t</span> PMC38 : <span class="hljs-number">3</span>;
      <span class="hljs-keyword">uint8_t</span>             : <span class="hljs-number">5</span>;
    } PMC38_b;
  };

  ...

  <span class="hljs-keyword">union</span>
  {
    __IOM <span class="hljs-keyword">uint32_t</span> PFC38;
    <span class="hljs-keyword">struct</span>
    {
      __IOM <span class="hljs-keyword">uint16_t</span> L;
      __IOM <span class="hljs-keyword">uint16_t</span> H;
    } PFC38_hword;
    <span class="hljs-keyword">struct</span>
    {
      __IOM <span class="hljs-keyword">uint8_t</span> LL;
      __IOM <span class="hljs-keyword">uint8_t</span> LH;
      __IOM <span class="hljs-keyword">uint8_t</span> HL;
      __IOM <span class="hljs-keyword">uint8_t</span> HH;
    } PFC38_byte;
    <span class="hljs-keyword">struct</span>
    {
      __IOM <span class="hljs-keyword">uint8_t</span> PFC38_0 : <span class="hljs-number">3</span>;
      <span class="hljs-keyword">uint8_t</span>               : <span class="hljs-number">1</span>;
      __IOM <span class="hljs-keyword">uint8_t</span> PFC38_1 : <span class="hljs-number">3</span>;
      <span class="hljs-keyword">uint8_t</span>               : <span class="hljs-number">1</span>;
      __IOM <span class="hljs-keyword">uint8_t</span> PFC38_2 : <span class="hljs-number">3</span>;
      <span class="hljs-keyword">uint8_t</span>               : <span class="hljs-number">5</span>;
      <span class="hljs-keyword">uint8_t</span>               : <span class="hljs-number">8</span>;
      <span class="hljs-keyword">uint8_t</span>               : <span class="hljs-number">8</span>;
    } PFC38_b;
  };

  ...

  __IM <span class="hljs-keyword">uint8_t</span> RESERVED314[<span class="hljs-number">3</span>];
  <span class="hljs-keyword">union</span>
  {
    __IOM <span class="hljs-keyword">uint8_t</span> PWPR;
    <span class="hljs-keyword">struct</span>
    {
      <span class="hljs-keyword">uint8_t</span>             : <span class="hljs-number">6</span>;
      __IOM <span class="hljs-keyword">uint8_t</span> PFCWE : <span class="hljs-number">1</span>;
      __IOM <span class="hljs-keyword">uint8_t</span> BOWI  : <span class="hljs-number">1</span>;
    } PWPR_b;
  };

  ...

} R_GPIO_Type;

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> R_GPIO_BASE    0x41030010</span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> R_GPIO    ((R_GPIO_Type *) R_GPIO_BASE)</span>


R_GPIO-&gt;PMC38_b.PMC38 = R_GPIO-&gt;PMC38_b.PMC38 | <span class="hljs-number">0x3</span>;    <span class="hljs-comment">//P40_0 P40_1 Peripheral Function Mode    //offset: 0x0238</span>

R_GPIO-&gt;PWPR_b.BOWI = <span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span>(R_GPIO-&gt;PWPR_b.BOWI != <span class="hljs-number">0</span>);
R_GPIO-&gt;PWPR_b.PFCWE = <span class="hljs-number">1</span>;   <span class="hljs-comment">//PFC write en  //0x3014</span>

R_GPIO-&gt;PFC38_b.PFC38_0 = <span class="hljs-number">1</span>;    <span class="hljs-comment">//p40_0&#xFF0C;&#x590D;&#x7528;&#x529F;&#x80FD;1   // 0x04e0</span>
R_GPIO-&gt;PFC38_b.PFC38_1 = <span class="hljs-number">1</span>;

R_GPIO-&gt;PM38_b.PM38_0 = <span class="hljs-number">2</span>;  <span class="hljs-comment">//P40_0&#xFF0C;TX&#xFF0C;output   // 0x0170</span>
R_GPIO-&gt;PM38_b.PM38_1 = <span class="hljs-number">1</span>;  <span class="hljs-comment">//P40_1&#xFF0C;RX&#xFF0C;input</span>
</code></pre>
<h4 id="422-scif">4.2.2. SCIF</h4>
<p>&#x9A71;&#x52A8;&#x6587;&#x4EF6;&#x5728;<code>rzg\fsp\src\r_scif_uart\r_scif_uart.c</code>&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x64CD;&#x4F5C;SCIF&#x76F8;&#x5173;&#x5BC4;&#x5B58;&#x5668;&#x7684;&#x64CD;&#x4F5C;</p>
<p>&#x5BF9;&#x4E8E;&#x9879;&#x76EE;&#x4E2D;&#x8BBE;&#x7F6E;&#x4F7F;&#x7528;&#x7684;SCIF1&#xFF0C;&#x76F8;&#x5173;&#x5B9A;&#x4E49;&#x5728;<code>rzg_gen\hal_data.c</code>&#x4E2D;&#x7684;<code>const uart_instance_t g_uart1</code>&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E86;&#x4E32;&#x53E3;&#x7684;&#x5C5E;&#x6027;&#x3001;&#x64CD;&#x4F5C;api&#x7B49;</p>
<p><code>src\serial.c</code>&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x5C5E;&#x4E8E;&#x5E94;&#x7528;&#x4EE3;&#x7801;&#xFF0C;&#x5BF9;SCIF&#x7684;&#x9A71;&#x52A8;&#x518D;&#x8FDB;&#x884C;&#x5C01;&#x88C5;</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">outbyte1</span><span class="hljs-params">(console_t console, <span class="hljs-keyword">char</span> c)</span>
</span>{
  flag_tend = <span class="hljs-number">0</span>;
  g_uart1.p_api-&gt;write(g_uart1.p_ctrl, &amp;c, <span class="hljs-number">1</span>);
  <span class="hljs-keyword">while</span>(flag_tend == <span class="hljs-number">0</span>)
  {
    __WFI();
  }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">outbyte</span><span class="hljs-params">(console_t console, <span class="hljs-keyword">char</span> c)</span>
</span>{
  <span class="hljs-keyword">if</span> (!xSerialPortInitialized)
  {
    g_uart1.p_api-&gt;open(g_uart1.p_ctrl, g_uart1.p_cfg);
    g_uart1.p_api-&gt;callbackSet(g_uart1.p_ctrl, uart_callback, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);
    xSerialPortInitialized = <span class="hljs-number">1</span>;
  }

  <span class="hljs-comment">/* Standard practice to convert \n to \r\n */</span>
  <span class="hljs-keyword">if</span> (c == <span class="hljs-string">&apos;\n&apos;</span>)
    outbyte1(console, <span class="hljs-string">&apos;\r&apos;</span>);

  outbyte1(console, c);
}
</code></pre>
<h4 id="423-&#x5173;&#x4E8E;printf">4.2.3. &#x5173;&#x4E8E;printf</h4>
<p>&#x745E;&#x8428;&#x4FEE;&#x6539;&#x4E86;<code>mbed Microcontroller Library</code>&#xFF0C;&#x901A;&#x8FC7;<code>mbed_minimal_formatted_string</code>&#x5C06;&#x6570;&#x636E;&#x683C;&#x5F0F;&#x5316;&#x5904;&#x7406;&#xFF0C;&#x8C03;&#x7528;<code>outbyte()</code>&#x901A;&#x8FC7;&#x4E32;&#x53E3;&#x53D1;&#x9001;</p>
<pre><code class="lang-c"><span class="hljs-comment">/*
 * Modified by Renesas so functions pass a context down to outbyte().
 * outbyte() is implemented elsewhere so that it can pass a context that our
 * serial output function. This is all done to allow us to create a printf_raw()
 * function that outputs immediately to the UART for emergency output such as an
 * abort.
 */</span>

<span class="hljs-comment">/**
 * @brief      Parse formatted string and invoke write handlers based on type.
 *
 * @param      buffer     The buffer to write to, write to stdout if NULL.
 * @param[in]  length     The length of the buffer.
 * @param[in]  format     The formatted string.
 * @param[in]  arguments  The va_list arguments.
 * @param[in]  console The method of char data control.
 *
 * @return     Number of characters written.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">mbed_minimal_formatted_string</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *buffer, size_t length, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *format, va_list arguments, console_t console)</span>
</span></code></pre>
<h3 id="43-&#x5173;&#x4E8E;&#x94FE;&#x63A5;">4.3. &#x5173;&#x4E8E;&#x94FE;&#x63A5;</h3>
<p>&#x94FE;&#x63A5;&#x811A;&#x672C;&#x5728;<code>script\fsp.ld</code></p>
<p>CM33&#x6838;&#x7684;&#x7A0B;&#x5E8F;&#x7F16;&#x8BD1;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#x662F;<code>rzg2l_cm33_rpmsg_demo.elf</code>&#xFF0C;&#x9700;&#x8981;&#x7ECF;&#x8FC7;<code>after_build.bat</code>&#x5904;&#x7406;</p>
<pre><code class="lang-bat">arm-none-eabi-objcopy -O binary -j .secure_vector %<span class="hljs-number">1</span>.elf %<span class="hljs-number">1</span>_secure_vector.bin
arm-none-eabi-objcopy -O binary -j .non_secure_vector %<span class="hljs-number">1</span>.elf %<span class="hljs-number">1</span>_non_secure_vector.bin
arm-none-eabi-objcopy -O binary -j .secure_code %<span class="hljs-number">1</span>.elf %<span class="hljs-number">1</span>_secure_code.bin
arm-none-eabi-objcopy -O binary -j .non_secure_code -j .data %<span class="hljs-number">1</span>.elf %<span class="hljs-number">1</span>_non_secure_code.bin
</code></pre>
<h4 id="&#x70E7;&#x5F55;">&#x70E7;&#x5F55;</h4>
<p>&#x70E7;&#x5F55;&#x7684;&#x65F6;&#x5019;&#x53EA;&#x7528;&#x5230;&#x4E86;<code>secure_vector</code> <code>non_secure_vector</code> <code>secure_code</code> <code>non_secure_code</code>&#x8FD9;&#x56DB;&#x4E2A;section&#xFF0C;CM33&#x6838;&#x7684;&#x7A0B;&#x5E8F;&#x662F;&#x5728;uboot&#x9636;&#x6BB5;&#x52A0;&#x8F7D;&#x5E76;&#x542F;&#x52A8;cm33&#x6838;</p>
<p>&#x5206;&#x522B;&#x628A;&#x56DB;&#x6BB5;&#x7A0B;&#x5E8F;&#x52A0;&#x8F7D;&#x5230;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;</p>
<table>
<thead>
<tr>
<th style="text-align:left">bin</th>
<th style="text-align:center">addr</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">rzg2l_cm33_rpmsg_demo_non_secure_vector.bin</td>
<td style="text-align:center">0x00010000</td>
</tr>
<tr>
<td style="text-align:left">rzg2l_cm33_rpmsg_demo_secure_vector.bin</td>
<td style="text-align:center">0x0001FF80</td>
</tr>
<tr>
<td style="text-align:left">rzg2l_cm33_rpmsg_demo_non_secure_code.bin</td>
<td style="text-align:center">0x40010000</td>
</tr>
<tr>
<td style="text-align:left">rzg2l_cm33_rpmsg_demo_secure_code.bin</td>
<td style="text-align:center">0x42EFF440</td>
</tr>
</tbody>
</table>
<p>&#x4ECE;&#x5185;&#x5B58;&#x5361;&#x4E2D;&#x52A0;&#x8F7D;&#xFF0C;uboot&#x7684;shell&#x4E2D;&#x8F93;&#x5165;&#x547D;&#x4EE4;</p>
<pre><code class="lang-text">dcache off
mmc dev 1

fatload mmc 1:1 0x0001FF80 rzg2l_cm33_rpmsg_demo_secure_vector.bin
fatload mmc 1:1 0x42EFF440 rzg2l_cm33_rpmsg_demo_secure_code.bin
fatload mmc 1:1 0x00010000 rzg2l_cm33_rpmsg_demo_non_secure_vector.bin
fatload mmc 1:1 0x40010000 rzg2l_cm33_rpmsg_demo_non_secure_code.bin

cm33 start_debug 0x0001FF80 0x00010000
dcache on
</code></pre>
<p>&#x4ECE;emmc&#x4E2D;&#x52A0;&#x8F7D;</p>
<pre><code class="lang-text">dcache off
ext4load mmc 0:1 0x0001FF80 boot/cm33/rzg2l_cm33_rpmsg_demo_secure_vector.bin
ext4load mmc 0:1 0x42EFF440 boot/cm33/rzg2l_cm33_rpmsg_demo_secure_code.bin
ext4load mmc 0:1 0x00010000 boot/cm33/rzg2l_cm33_rpmsg_demo_non_secure_vector.bin
ext4load mmc 0:1 0x40010000 boot/cm33/rzg2l_cm33_rpmsg_demo_non_secure_code.bin
cm33 start_debug 0x0001FF80 0x00010000
dcache on
</code></pre>
<p>&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#xFF0C;&#x81EA;&#x52A8;&#x542F;&#x52A8;CM33&#x5185;&#x6838;&#xFF0C;&#x5176;&#x4E2D;bin&#x6587;&#x4EF6;&#x653E;&#x5728;<code>/boot/cm33/</code>&#xFF0C;&#x4ECE;emmc&#x4E2D;&#x52A0;&#x8F7D;&#x5230;&#x6307;&#x5B9A;&#x5730;&#x5740;&#xFF0C;&#x4E4B;&#x540E;&#x542F;&#x52A8;CM33</p>
<pre><code class="lang-text">setenv name4cm33 rzg2l_cm33_rpmsg_demo
setenv emmcloadcm33 &apos;ext4load mmc 0:1 0x0001FF80 boot/cm33/${name4cm33}_secure_vector.bin;ext4load mmc 0:1 0x42EFF440 boot/cm33/${name4cm33}_secure_code.bin;ext4load mmc 0:1 0x00010000 boot/cm33/${name4cm33}_non_secure_vector.bin;ext4load mmc 0:1 0x40010000 boot/cm33/${name4cm33}_non_secure_code.bin;&apos;
setenv startcm33 &apos;dcache off;run emmcloadcm33;cm33 start_debug 0x0001FF80 0x00010000;dcache on;&apos;
setenv bootcmd &apos;run startcm33;run bootcmd_check;run bootimage&apos;

saveenv
</code></pre>
<h2 id="&#x53C2;&#x8003;">&#x53C2;&#x8003;</h2>
<ul>
<li><a href="https://www.openampproject.org/docs/whitepapers/Introduction_to_OpenAMPlib_v1.1a.pdf" target="_blank">Introduction_to_OpenAMPlib_v1.1a</a></li>
<li><a href="https://hceng.cn/2020/05/09/STM32MP157%E2%80%94%E2%80%94Remoteproc%E5%92%8CRPMsg/" target="_blank">STM32MP157&#x7684;Remoteproc&#x548C;RPMsg&#x6846;&#x67B6;</a></li>
<li><a href="https://forsworns.github.io/zh/blogs/20210223/" target="_blank">STM32MP157A&#x548C;IPCC</a></li>
<li><a href="https://blog.csdn.net/hpu11/article/details/109395820" target="_blank">Linux UIO&#x673A;&#x5236;--&#x7528;&#x6237;&#x7A7A;&#x95F4;I / O&#x64CD;&#x4F5C;&#x65B9;&#x6CD5;</a></li>
<li><a href="https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/2423717889/RPMsg+in+Linux+and+OpenAMP+Project" target="_blank">RPMsg in Linux and OpenAMP Project - Xilinx Wiki</a></li>
<li><a href="https://docs.xilinx.com/r/en-US/ug1186-zynq-openamp-gsg/Libmetal-and-OpenAMP-User-Guide" target="_blank">UG1186 - Libmetal and OpenAMP User Guide (v2022.1)</a></li>
<li><a href="https://github.com/OpenAMP/open-amp/wiki/OpenAMP-remoteproc" target="_blank">OpenAMP remoteproc wiki</a></li>
<li><a href="https://blog.csdn.net/weixin_42813232/article/details/125577142" target="_blank">Rpmsg&#x4E0E;Virtio&#x4ECB;&#x7ECD;</a></li>
<li><a href="https://blog.csdn.net/ZM_Yang/article/details/107453233" target="_blank">RPMsg&#xFF1A;&#x534F;&#x8BAE;&#x7B80;&#x4ECB;</a></li>
<li><a href="https://www2.renesas.cn/cn/en/software-tool/rzg2l-and-rzg2ul-group-multi-os-package#overview" target="_blank">RZ/G2L and RZ/G2UL Group Multi-OS Package</a></li>
<li><a href="http://linux.51yip.com/search/objcopy" target="_blank">objcopy &#x4ECB;&#x7ECD;</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="RZG2L-GPT.html" class="navigation navigation-prev " aria-label="Previous page: RZG2L-GPT">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="RZG2L-Camera.html" class="navigation navigation-next " aria-label="Next page: RZG2L-Camera">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"RZG2L-IPC","level":"1.3.3","depth":2,"next":{"title":"RZG2L-Camera","level":"1.3.4","depth":2,"path":"Linux/RZG2L-Camera.md","ref":"./Linux/RZG2L-Camera.md","articles":[]},"previous":{"title":"RZG2L-GPT","level":"1.3.2","depth":2,"path":"Linux/RZG2L-GPT.md","ref":"./Linux/RZG2L-GPT.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","-sharing","theme-simple@git+https://github.com/plugins-zander/gitbook-plugin-theme-simple.git","search-pro@git+https://github.com/plugins-zander/gitbook-plugin-search-pro.git","splitter@git+https://github.com/plugins-zander/gitbook-plugin-splitter.git","chapter-fold@git+https://github.com/plugins-zander/gitbook-plugin-chapter-fold.git","code"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"search-pro":{},"splitter":{},"chapter-fold":{},"code":{"copyButtons":true},"highlight":{},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-simple":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Liyi","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Notes","language":"zh-hans","gitbook":"3.2.3","description":"A new life"},"file":{"path":"Linux/RZG2L-IPC.md","mtime":"2022-12-02T07:39:13.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-12-08T09:18:43.153Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

